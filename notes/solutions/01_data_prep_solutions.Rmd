---
title: 'Solutions to Ch3: Data Preparation'
author: "MATH 456 - Spring 2016"
output:
  html_document:
    highlight: pygments
    theme: spacelab
  pdf_document: default
---

# Intial setup
It is good practice (and good coding form) to load all libraries and read in all 
data sets used in the document in the first code chunk. This is also where
you would want to set any global options. 
```{r, warning=FALSE, message=FALSE}
# Libraries
library(knitr); library(rmarkdown)
library(ggplot2);library(gridExtra)
library(car); library(readxl)

# Global options: don't show warnings or messages generated by code chunks
opts_chunk$set(warning=FALSE, message=FALSE) 

# Read in all data
depress <- read.table("C:/GitHub/MATH456/data/Depress.txt", sep="\t", header=TRUE) 
hiv     <- read_excel("C:/GitHub/MATH456/data/Parhiv.xlsx")
```


#### <span style="color: LimeGreen">On Your Own: Data Wrangling</span>
1.  **Using the depression data set, create a new variable that collapses the 
    first three education levels.**
```{r}
depress$EDUCAT <- factor(depress$EDUCAT, 
                          labels = c("<HS", "Some HS", "HS Grad", "Some college", "BS", "MS", "PhD"))
depress$EDUCAT2 <- recode(depress$EDUCAT, "'<HS' = 'Up to HS grad'; 
                                           'Some HS' = 'Up to HS grad'; 
                                           'HS Grad' = 'Up to HS grad'")
```
Confirm your recode by displaying a contingency table of the old variable
`EDUCAT` against your new variable. Be sure to use the `useNA="always"` 
argument in the `table()` statement. 

```{r}
table(depress$EDUCAT, depress$EDUCAT2, useNA="always")
```
Recode confirmed. The 5 people with less than HS, 61 with some HS, and the
114 HS grads are now labeled _Up to HS grad_ using the variable `EDUCAT2`. 


2.  **What can you say about the relationship between Income and Educational
level?**  
One common way to examine the distribution of a continuous variable `Income`
acrosslevels of a categorical variable `Education` is to create side by side
boxplots. Using the code from the lecture notes that creates this plot across
marital status, and updating the x variable from `MARITAL` to `EDUCAT2` we
get the following plot. 
```{r}
qplot(y=INCOME, x=EDUCAT2, data=depress, geom="boxplot") + 
   stat_summary(fun.y=mean, colour="blue", size=3, geom="point")
```

Notice carefully now that if you read left to right, education level does
not strictly increase. Specifically notice that the categories are displayed
in alphabetical order, not in any order that makes reasonable sense. This can
be adjusted by specifying the ordering of the levels of the factor variable.
The code for this solution was found on
http://www.cookbook-r.com/Manipulating_data/Changing_the_order_of_levels_of_a_factor/

```{r}
depress$EDUCAT2 <- factor(depress$EDUCAT2, 
                          levels=c("Up to HS grad", "Some college", "BS", "MS", "PhD"))
qplot(y=INCOME, x=EDUCAT2, data=depress, geom="boxplot", xlab="Education Level") + 
   stat_summary(fun.y=mean, colour="blue", size=3, geom="point")
```

Note that this reordering could have been done in a single step when we first
converted the `EDUCAT` variable to a factor variable, but not the new `EDUCAT2`
variable. 
```{r, eval=FALSE}
# Example code to create a factor variable and define the levels at the same time. 
depress$EDUCAT <- factor(depress$EDUCAT, 
                          labels = c("<HS", "Some HS", "HS Grad", "Some college", "BS", "MS", "PhD"), 
                          levels = c("<HS", "Some HS", "HS Grad", "Some college", "BS", "MS", "PhD"))
```

Now it is clear to see that as the amount of education increases so does the
mean (blue dots) and median income levels. There is a potential outlier with
over $60k annual income but with no more than a HS diploma. This individual 
record should be examined in any analysis to determine if it is an influential
point. 


3.  **Determine if any variables in the depression data set have observations
    that do not fall within the ranges given in the codebook. If there are any, 
    decide what to do with those values and implement your decision.**
There are a lot of variables in the Depression data set, so (for me) the easiest
way to visually confirm that all values are within the expected range is to do
a summary of the entire data set. This produces a lot of output, but I can then
go through each variable one by one, and cross-check the data against what is
written in the codebook.

Notice now that `SEX` is still being treated as numeric with values 1 and 2, 
but `EDUCAT` now is being displayed properly as a categorical variable with
our specified labels. 
```{r}
summary(depress)
```

Right away, at the end of the first line I notice that `RELIG` has a max value
of 6, when there is no 6th category acording to the codebook. 
```{r}
table(depress$RELIG)
```
Without any other information to indicate what the correct response should have
been, these values are set to missing. 

The easiest way to perform a recode when there is only two options (or one
simple logical statement) is to use the `ifelse()` function. This has three
pieces: `ifelse(logical statement, value if TRUE, value if FALSE)`. 
```{r}
depress$RELIG <- ifelse(depress$RELIG == 6, NA, depress$RELIG)
```
Let's break down each piece to help you understand the logic. 

<span style="color: blue">depress$RELIG<- </span> 

<span style="color: red">ifelse(depress$RELIG == 6, </span> 

<span style="color: green">NA, </span> 

<span style="color: purple"> depress$RELIG)</span> 


This line of code says that <span style="color: red">if the religion variable
is 6 (logical statement)</span>, then <span style="color: blue">assign the value of this variable</span>
to be <span style="color: green">missing (value if the logical statment is TRUE)</span>, 
<span style="color: purple">otherwise don't change the variable from it's current 
value (value if the logical statement is FALSE)</span>. 

Then, always, confirm your recodes. It worked becuase the 2 cases that were
under category 6 are now set as NA (missing). 
```{r}
table(depress$RELIG, useNA="always")
```


4.  **Update the Parental HIV data set by creating all the subscales listed at 
    the bottom of the codebook.**
```{r}
# stuff
```

**Use the `write.table()` function to write this data set as a tab-delimited 
  text file using the current date in the file name.**
```{r}
write.table(hiv, "C:/GitHub/MATH456/data/PARHIV_013116.txt", sep="\t", row.names=FALSE, col.names=FALSE)
```
    
# Session Info
This document was compiled on `Sys.time()` and with the following system
information:
```{r}
sessionInfo()
```