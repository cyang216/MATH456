---
title: "Preparing Data for Analysis"
author: "MATH 456"
date: "Week 1"
output:
  ioslides_presentation:
    highlight: pygments
  beamer_presentation:
    colortheme: beaver
    fonttheme: professionalfonts
    highlight: pygments
    theme: Warsaw
  slidy_presentation:
    highlight: pygments
---


## Types of variables
* **Continuous:** Things that can be measured
    - Height, weight, density
* **Discrete / Integer:** Can only hold whole number values
    - counts of things
* **Categorical:** Non-numeric characteristics
    - Gender, ethnicity
* **Binary:** Two categories only
    - Gender
* **Indicator:** A binary variable that is yes/no depending on a specified criteria
    - Typically holds values of 1/0 or TRUE/FALSE
    - Female, on medicare 


## Stevens's classification of variables
* **Nominal:** A.k.a categorical. Each observation belongs to one of several distinct categories. No inherent ordering.
    - Gender (M/F), Ethnicity (White/AfAm/Hispanic)
* **Ordinal:** Categorical variables with an inherent ordering. 
    - First(1), second(2), third(3), Strongly agree(5), agree(4), neutral(3), disagree(2), strongly disagree(1)
* **Interval:** Differences between successive values are always the same. 
    - Temperature, calendar dates
* **Ratio:** Interval variables with a natural zero point
    - Height, weight, density, time duration
    
Q: Why is Temperature not ratio?


## Data Types found in computer data sets
* **Numerical:** `r round(pi,5)`
* **Integer:** `r seq(0,5,1)`
* **Character / String:** "Hello World", "Blue"
* **Logical:** TRUE/FALSE



## Describing relationships between variables
Multiple names for the same concept

* Response / Outcome / Dependent variable
* Covariate / Explanatory / Predictor / Independent variable

The direction of the relationship is situation dependent. 

* We could use weight as an outcome variable with height, sex, age and diet as predictors  
* We could use blood pressure as the outcome with weight, sex, age and diet as predictors

## Practice - Vocabulary
1. Classify the following types of data by using Stevens's measurement system: decibels of noise level, father's occupation, parts per  million of an impurity in water, density of a piece of bone, rating of a wine by one judge, net profit of a firm, and score on an aptitude test.  
2. Pose two possible research questions from the CORD study (Lung function data) and decide on the appropriate dependent and independent variables.  
3. Give an example of nominal, ordinal, interval, and ratio variables from a field of application you are familiar with. 



## Research Pipeline

![Repro](pipeline.png)

Credits: Roger Peng

## Reproducibility

* You are your own collaborator 6 months from now. Make sure you will be able to understand what you were doing.
* Investing the time to do things clearly and in a reproducible manner will make your future self happy.
* Comment your code with explanations and instructions.
    - How did you get from point A to B? 
    - Why did you recode this variable in this manner? 
* Use tools to aid reproducbility such as R Markdown.

## Codebooks
A **codebook** or **data dictionary** is a document that contains a description of each variable in the data set, including the variable name, data type, valid values and instructions on how the variable was created as applicable. 

* [Open Intro: North Carolina Births Codebook](../data/NCBirthsCodebook.html)


## Tidy Data

```{r}
head(iris[c(1,2,3,5)])
```
* One row per observation/case/individual
* One column per characteristic
* Variable names are short, yet descriptive (Ex:`depress.txt` vs `NCbirths.csv`)

The `reshape2` and `tidyr` packages contain common functions and methods used to create tidy data. 

## Practice
The US Census can provide a lot of demographic and economic information organized by geographical regions across the united states. A lot of information is available, but it is typically not in an analyzable format. 

You are going to download some Census data on poverty rates in CA, create a codebook and start to tidy the data to make it into an analyzable format. 

## Practice
1. Go [here](https://cdph.data.ca.gov/Demographics/Poverty-Rate-defined-by-U-S-Census-by-California-R/pbut-di2i) and download (export) the data on Poverty rates by California regions from 2000-2010. Store this in your DATA folder.
2.  Click on the red "About" button - Under _Attachments_ download the data dictionary (XLSX file) and the Narrative Examples pdf. 
3. Download a copy of the NCBirths codebook Markdown template from the [Data page](../data/Datasets.html) of the class website. 
4. Using this template, start to create a codebook for this data using the information available on the website. Be sure to include a description of the data. 
5. Variables to include: `reportyear, race_eth_name, geotype, county_name, region_name, Poverty, TotalPop, NumPov, CA_RR`


## Processing Data
Once the data has been collected, there are a number of steps that must occur before the data can be analyzed. 

* Missing data identified
* Outliers identified
* Data edited to recode missing or outling values. 
* New variables created using transformations of existing variables. 
* Reshaping data to create Tidy Data

## Missing data identified
* Missing data in `R` is denoted as `NA`
* Arithmetic functions on missing data will return missing
```{r, echo=2:3}
library(MASS)
head(survey$Pulse)
mean(survey$Pulse)
```

## Missing data identified (cont.) 
The `summary()` function will alway show missing.
```{r}
summary(survey$Pulse)
```
The `is.na()` function is helpful to identify rows with missing data
```{r}
table(is.na(survey$Pulse))
```

## Missing data identified (cont.)
* The function `table()` will not show NA by default. 
```{r}
table(survey$M.I)
table(survey$M.I, useNA="always")
```
Look at `?table` for other options to the `useNA` argument. 


## Dealing with missing data - Option 1
```{r, echo=FALSE, warning=FALSE, message=FALSE}
library(dplyr)
```
* Complete case analysis: Drop all records with missing data
    - We will use this option for now.
```{r, warning=FALSE, message=FALSE}
# complete case function on a single variable
mean(survey$Pulse, na.rm=TRUE) 
```
Drop entire records that are missing values on the variable of interest. 
`dim(survey)` = `r dim(survey)`
```{r}
survey1 <- survey[!is.na(survey$Pulse),] 
survey2 <- survey %>% filter(!is.na(Pulse)) 
```
`dim(survey1)` = `r dim(survey1)`  
`dim(survey2)` = `r dim(survey2)`

## Dealing with missing data - Option 1 (cont.)
Or drop ALL rows with missing on ANY variable
```{r, warning=FALSE, message=FALSE}
survey3 <- na.omit(survey) 
dim(survey3)
```

## Dealing with missing data - Option 2
* Imputation. 
    - Fill in missing values with data to elimintate missing
    - Method of imputation is important
    - Will cover imputation methods later 

## Outliers identified
Typically identified using graphical methods. 
```{r, message=FALSE, warning=FALSE, echo=FALSE}
library(ggplot2); library(gridExtra)
a <- qplot(y=Pulse, x=1,data=survey, geom="boxplot")
b <- qplot(1:NROW(survey), Pulse, data=survey, geom="point")
grid.arrange(a,b,ncol=2)
```

## Data edited to recode missing or outling values
Data editing is changing the value of the raw data from one value to another based on a set of pre-defined deterministic criteria.  (Review `?ifelse`)
```{r}
survey$M.I.2 <- ifelse(is.na(survey$M.I), "Unknown", survey$M.I)
table(survey$M.I, survey$M.I.2)
survey$Pulse <- ifelse(survey$Pulse > 100, 100, survey$Pulse)
```

## New variables created using transformations of existing variables
Using the `mutate` argument from `dplyr` to calculate BMI on the `women` data set bulit into R. 
```{r}
women <- women %>% mutate(bmi = (weight*703)/(height^2))
head(women)
```


## Practice: Cleaning the US Census data continued. 
1. Use `filter` to drop data on the census tract level, and aggregated report years 2006-10 
    - `geotype!=CT, Poverty != "Concentrated", reportyear != "2006-2010"`
2. Use `mutate` to rename `percent` to `PctPov` and `Poverty` to `PovType`.
3. Use `select` to only keep the following variables: `reportyear, race_eth_name, geotype, county_name, region_name, PovType, TotalPop, NumPov, PctPov, CA_RR`.
    - Make sure these variables are accurate in your codebook. 



